{"version":3,"file":"static/js/155.1a33e005.chunk.js","mappings":"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","sources":["Pages/MainPages/Productos.js"],"sourcesContent":["import React, { useState } from 'react'\r\nimport { useEffect } from 'react';\r\nimport { axiosContoken } from '../../helpers/axiosAPI';\r\nimport { SmallLoading } from '../ui/SmallLoading';\r\nimport moment from 'moment'\r\nimport { useCallback } from 'react';\r\nimport { ModalProducto } from './Modals/ModalProducto';\r\n\r\nconst Productos = () => {\r\n\r\n    const [productos, setProductos] = useState([])\r\n    const [allProds, setAllProds] = useState([])\r\n    const [paginacion, setPaginacion] = useState(0)\r\n    const [loadingProds, setLoadingProds] = useState(false)\r\n    const [openModal, setOpenModal] = useState(false)\r\n    const [currentProducto, setCurrentProducto] = useState({})\r\n\r\n    const cambiarPaginacion = async (valor = 0) => {\r\n        if (Math.ceil((paginacion + valor) * 10) <= allProds.length) {\r\n            setPaginacion(prev => Math.max(0, prev + valor))\r\n        }\r\n    }\r\n\r\n    const sortBy = (campo = 'descripcion') => {\r\n        const arrProds = [...allProds]\r\n        setAllProds(arrProds.sort((a, b) => b?.[campo] - a?.[campo]))\r\n        setProductos([...arrProds.slice(paginacion * 10, paginacion * 10 + 10)])\r\n    }\r\n\r\n    const getData = useCallback(\r\n        async () => {\r\n\r\n            try {\r\n                const dataGeneral = JSON.parse(localStorage.getItem('datosProds') ? localStorage.getItem('datosProds') : '');\r\n                if (dataGeneral?.lastUpdate && moment(new Date()).isBefore(moment(dataGeneral?.lastUpdate).add(10, 'm'), 'm')) {\r\n                    setAllProds(dataGeneral?.data)\r\n                    setProductos(dataGeneral?.data?.slice(0, 10))\r\n                    return;\r\n                }\r\n\r\n            } catch (ex) { }\r\n            setLoadingProds(true);\r\n            try {\r\n\r\n                const prods = await axiosContoken(`productos/precios`);\r\n                if (prods?.data?.ok) {\r\n                    let arrItems = []\r\n                    prods.data.precios.forEach(element => {\r\n                        if (arrItems?.[element?.codigoPrincipal]) {\r\n                            arrItems[element?.codigoPrincipal].total = arrItems[element?.codigoPrincipal].total + 1\r\n                            if (arrItems?.[element?.codigoPrincipal]?.precioMin > element?.precioUnitario || arrItems?.[element?.codigoPrincipal]?.precioMax < element?.precioUnitario) {\r\n                                arrItems[element?.codigoPrincipal].precioMin = element?.precioUnitario\r\n                                arrItems[element?.codigoPrincipal].fechaRegistroMax = moment(element?.fechaRegistro).format('DD-MM-YYYY')\r\n                                arrItems[element?.codigoPrincipal].establecimiento = element?.establecimiento?.razonSocial\r\n                            }\r\n                            if ( arrItems?.[element?.codigoPrincipal]?.precioMax < element?.precioUnitario) {\r\n                                arrItems[element?.codigoPrincipal].precioMax = element?.precioUnitario\r\n                                arrItems[element?.codigoPrincipal].fechaRegistroMin = moment(element?.fechaRegistro).format('DD-MM-YYYY')\r\n                                arrItems[element?.codigoPrincipal].establecimiento = element?.establecimiento?.razonSocial\r\n                            }\r\n                        } else {\r\n                            arrItems[element?.codigoPrincipal] = {\r\n                                codigo: element?.codigoPrincipal,\r\n                                descripcion: element?.producto?.descripcion,\r\n                                precioMin: element?.precioUnitario,\r\n                                precioMax: element?.precioUnitario,\r\n                                fechaRegistroMax: moment(element?.fechaRegistro).format('DD-MM-YYYY'),\r\n                                fechaRegistroMin: moment(element?.fechaRegistro).format('DD-MM-YYYY'),\r\n                                establecimiento: element?.establecimiento?.razonSocial,\r\n                                total: 1\r\n                            }\r\n                        }\r\n\r\n                    });\r\n                    localStorage.setItem('datosProds', JSON.stringify({ data: Object.values(arrItems), lastUpdate: new Date() }))\r\n                    setAllProds(Object.values(arrItems))\r\n                    setProductos(Object.values(arrItems).slice(0, 10))\r\n                }\r\n            } catch (error) { }\r\n            setLoadingProds(false);\r\n        },\r\n        [],\r\n    )\r\n\r\n\r\n    useEffect(() => {\r\n        getData();\r\n    }, [getData]);\r\n\r\n    useEffect(() => {\r\n        setProductos([...allProds.slice(paginacion * 10, paginacion * 10 + 10)])\r\n    }, [paginacion, allProds])\r\n\r\n    const actualizarData = () => {\r\n        localStorage.removeItem(\"datosProds\")\r\n        getData();\r\n    }\r\n\r\n    const showHistorialProducto = async (producto) => {\r\n        try {\r\n\r\n            const response = await axiosContoken(`productos/${producto?.codigo}`);\r\n            if (response?.data?.ok) {\r\n                setCurrentProducto({ producto, precios: response?.data?.precios?.sort((a, b) => new Date(a?.fechaRegistro).getTime() - new Date(b?.fechaRegistro).getTime()) })\r\n                setOpenModal(true);\r\n            }\r\n        } catch (error) { }\r\n    }\r\n\r\n    return (\r\n        <div className='container mt-5 '>\r\n            <div className='d-flex justify-content-between'>\r\n\r\n                <h2 className='d-inline' >Productos</h2>\r\n                <button onClick={actualizarData}>Actualizar</button>\r\n            </div>\r\n            <hr />\r\n            {loadingProds ? <div className='row d-flex justify-content-center'><SmallLoading /></div> : <>\r\n                <div className='row d-flex justify-content-end mx-5 my-2'>\r\n                    {paginacion * 10} - {paginacion * 10 + 10} de {allProds.length}\r\n                </div>\r\n                <div className='col-12 d-flex justify-content-center flex-wrap h-75 table-min'>\r\n                    <div onClick={() => sortBy('descripcion')} className='col-3 text-white px-2 border'>Descripción</div>\r\n                    <div onClick={() => sortBy('precioMin')} className='col-1 text-white px-2 border'>Precio mínimo</div>\r\n                    <div onClick={() => sortBy('precioMax')} className='col-1 text-white px-2 border'>Precio máximo</div>\r\n                    <div onClick={() => sortBy('fechaRegistro')} className='col-3 text-white px-2 border'>Fecha registro max/min</div>\r\n                    <div onClick={() => sortBy('total')} className='col-1  text-white px-2 border'>Total registrados</div>\r\n                    <div onClick={() => sortBy('establecimiento')} className='col-3 text-white px-2 border'>Establecimiento</div>\r\n                    {productos.map(prod => {\r\n                        return <div className='col-12 p-0 m-0 prod-class d-flex flex-wrap align-items-center border-start border-end pointer' onClick={() => showHistorialProducto(prod)} key={prod.codigo}>\r\n                            <div title={prod.descripcion} className='col-3  text-white px-2 '>{(prod.descripcion.length > 30) ? prod.descripcion.slice(0, 26) + '...' : prod.descripcion}</div>\r\n                            <div className='col-1  text-white px-2'>$ {prod.precioMin?.toFixed(2)}</div>\r\n                            <div className='col-1  text-white px-2'>$ {prod.precioMax?.toFixed(2)}</div>\r\n                            <div className='col-3  text-white px-2'>{prod.fechaRegistroMax}{' '}/{' '}{prod.fechaRegistroMin}</div>\r\n                            <div className='col-1  text-white px-2'> {prod.total}</div>\r\n                            <div title={prod.establecimiento} className='col-3  text-white px-2 '>{(prod.establecimiento.length > 30) ? prod.establecimiento.slice(0, 26) + '...' : prod.establecimiento}</div>\r\n                        </div>\r\n                    })}\r\n                    <div className='col-12 d-flex justify-content-center border-top pt-5'>\r\n                        <button className='btn btn-primary mx-5' onClick={() => cambiarPaginacion(-1)}>Atrás</button>\r\n                        <button className='btn btn-primary mx-5' onClick={() => cambiarPaginacion(1)}>Siguiente</button>\r\n                    </div>\r\n                </div>\r\n            </>\r\n            }\r\n            <ModalProducto openModal={openModal} setOpenModal={setOpenModal} producto={currentProducto} />\r\n        </div>\r\n    )\r\n}\r\n\r\n\r\nexport default Productos"],"names":["useState","productos","setProductos","allProds","setAllProds","paginacion","setPaginacion","loadingProds","setLoadingProds","openModal","setOpenModal","currentProducto","setCurrentProducto","cambiarPaginacion","valor","Math","ceil","length","prev","max","sortBy","campo","arrProds","sort","a","b","slice","getData","useCallback","dataGeneral","JSON","parse","localStorage","getItem","lastUpdate","moment","Date","isBefore","add","data","axiosContoken","prods","ok","arrItems","precios","forEach","element","codigoPrincipal","total","precioMin","precioUnitario","precioMax","fechaRegistroMax","fechaRegistro","format","establecimiento","razonSocial","fechaRegistroMin","codigo","descripcion","producto","setItem","stringify","Object","values","useEffect","showHistorialProducto","response","getTime","className","onClick","removeItem","map","prod","title","toFixed"],"sourceRoot":""}